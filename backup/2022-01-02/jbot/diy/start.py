#!/usr/bin/env python3
# -*- coding: utf-8 -*-


import os
import sys

from telethon import events

from .. import chat_id, jdbot, logger, TOKEN
from ..bot.utils import V4, QL

bot_id = int(TOKEN.split(':')[0])

@jdbot.on(events.NewMessage(from_users=chat_id, pattern=r'^/start$'))
async def myhello(event):
    try:
        msg_id = event.id
        if V4:
            msg = '''ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š
    /help è·å–å‘½ä»¤ï¼Œå¯ç›´æ¥å‘é€è‡³botfatherã€‚
    /start å¼€å§‹ä½¿ç”¨æœ¬ç¨‹åºã€‚
    /restart é‡å¯æœ¬ç¨‹åºã€‚
    /up å‡çº§æœ¬ç¨‹åºã€‚
    /upbot å‡çº§æ‹“å±•åŠŸèƒ½ã€‚
    /ver æŸ¥çœ‹ç¨‹åºç‰ˆæœ¬å·ã€‚
    /a ä½¿ç”¨ä½ çš„è‡ªå®šä¹‰å¿«æ·æŒ‰é’®ã€‚
    /clearboard åˆ é™¤å¿«æ·è¾“å…¥æŒ‰é’®ã€‚
    /bean è·å–äº¬è±†å˜åŒ–ï¼Œé»˜è®¤ä¸ºæ€»äº¬è±†æ”¶æ”¯ã€‚/bean in äº¬è±†è¿›è´¦ï¼Œ/bean out äº¬è±†æ”¯å‡ºã€‚
    /chart è·å–äº¬è±†å˜åŒ–æ•°æ®æŸ±çŠ¶å›¾å’Œæ›²çº¿å›¾ã€‚ä¾‹ï¼š/chart 1ï¼Œè·å–è´¦å·1äº¬è±†å˜åŒ–ã€‚
    /cmd æ‰§è¡Œå‘½ä»¤ï¼Œä¾‹ï¼š/cmd python3 /python/bot.pyï¼Œåˆ™æ‰§è¡Œpythonç›®å½•ä¸‹çš„bot.pyã€‚ä¸å»ºè®®ä½¿ç”¨BOTä½¿ç”¨å¹¶å‘ï¼Œå¯èƒ½äº§ç”Ÿä¸æ˜åŸå› çš„å´©æºƒã€‚ 
    /dl ä¸‹è½½æ–‡ä»¶ã€‚
    /edit ä»/jdç›®å½•é€‰æ‹©æ–‡ä»¶å¹¶ç¼–è¾‘ï¼Œéœ€è¦å°†ç¼–è¾‘å¥½ä¿¡æ¯å…¨éƒ¨å‘ç»™BOTï¼ŒBOTä¼šæ ¹æ®ä½ å‘çš„ä¿¡æ¯è¿›è¡Œæ›¿æ¢ã€‚å»ºè®®ä»…ç¼–è¾‘configæˆ–crontab.listï¼Œå…¶ä»–æ–‡ä»¶æ…ç”¨ï¼ï¼ï¼
    /getcookie æ‰«ç è·å–cookieï¼Œ30så†…å¯å–æ¶ˆï¼Œ31s~2åˆ†é’Ÿå†…ä¸èƒ½è¿›è¡Œå…¶ä»–äº¤äº’ç›´åˆ°è¶…æ—¶æˆ–è·å–åˆ°cookieã€‚
    /getfile è·å–/jdç›®å½•ä¸‹æ–‡ä»¶ã€‚
    /log æŸ¥çœ‹è„šæœ¬æ‰§è¡Œæ—¥å¿—ã€‚
    /node æ‰§è¡Œjsè„šæœ¬ï¼Œè¾“å…¥/node jd_bean_changeã€‚å¦‚æ‰§è¡Œéscriptsç›®å½•jsï¼Œéœ€è¾“å…¥ç»å¯¹è·¯å¾„æ‰§è¡Œã€‚nodeå‘½ä»¤ä¼šç­‰å¾…è„šæœ¬æ‰§è¡Œå®Œï¼ŒæœŸé—´ä¸èƒ½ä½¿ç”¨BOTï¼Œå»ºè®®ä½¿ç”¨snodeå‘½ä»¤ã€‚
    /set è®¾ç½®ã€‚
    /setshort è®¾ç½®è‡ªå®šä¹‰æŒ‰é’®ï¼Œæ¯æ¬¡è®¾ç½®ä¼šè¦†ç›–åŸè®¾ç½®ã€‚
    /setname è®¾ç½®å‘½ä»¤åˆ«åã€‚
    /snode é€‰æ‹©è„šæœ¬æ‰§è¡Œï¼Œåªèƒ½é€‰æ‹©/scriptså’Œ/ownç›®å½•ä¸‹çš„è„šæœ¬ï¼Œé€‰æ‹©å®Œåç›´æ¥åå°è¿è¡Œï¼Œä¸å½±å“BOTå“åº”å…¶ä»–å‘½ä»¤ã€‚ 
    /repo ç®¡ç†æ·»åŠ çš„ä»“åº“ã€‚
    /export ç®¡ç†æ·»åŠ çš„ç¯å¢ƒå˜é‡ã€‚
    /checkcookie æ£€æµ‹è´¦å·è¿‡æœŸã€‚
    /blockcookie å±è”½è´¦å·ã€‚
    /install æ‹“å±•æœ¬ç¨‹åºåŠŸèƒ½ã€‚
    /uninstall åˆ é™¤æœ¬ç¨‹åºæ‹“å±•åŠŸèƒ½ã€‚
    /list åˆ—å‡ºæœ¬ç¨‹åºæ‹“å±•çš„åŠŸèƒ½ã€‚
    
    æ­¤å¤–ï¼Œç›´æ¥å‘é€æ–‡ä»¶è‡³BOTï¼Œä¼šè®©æ‚¨é€‰æ‹©ä¿å­˜åˆ°ç›®æ ‡æ–‡ä»¶å¤¹ï¼Œæ”¯æŒä¿å­˜å¹¶è¿è¡Œã€‚å‘é€ä»¥ .git ç»“å°¾çš„é“¾æ¥å¼€å§‹æ·»åŠ ä»“åº“ã€‚å‘é€ä»¥ .js .sh .pyç»“å°¾çš„å·²rawé“¾æ¥å¼€å§‹ä¸‹è½½æ–‡ä»¶ã€‚å‘é€æ ¼å¼ä¸º key="value" æˆ–è€… key='value' çš„æ¶ˆæ¯å¼€å§‹æ·»åŠ ç¯å¢ƒå˜é‡ã€‚'''
        elif QL:
            msg = '''ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š
    /help è·å–å‘½ä»¤ï¼Œå¯ç›´æ¥å‘é€è‡³botfatherã€‚
    /start å¼€å§‹ä½¿ç”¨æœ¬ç¨‹åºã€‚
    /restart é‡å¯æœ¬ç¨‹åºã€‚
    /up å‡çº§æœ¬ç¨‹åºã€‚
    /upbot å‡çº§æ‹“å±•åŠŸèƒ½ã€‚
    /ver æŸ¥çœ‹ç¨‹åºç‰ˆæœ¬å·ã€‚
    /a ä½¿ç”¨ä½ çš„è‡ªå®šä¹‰å¿«æ·æŒ‰é’®ã€‚
    /clearboard åˆ é™¤å¿«æ·è¾“å…¥æŒ‰é’®ã€‚
    /bean è·å–äº¬è±†å˜åŒ–ï¼Œé»˜è®¤ä¸ºæ€»äº¬è±†æ”¶æ”¯ã€‚
    /chart è·å–äº¬è±†å˜åŒ–æ•°æ®æŸ±çŠ¶å›¾å’Œæ›²çº¿å›¾ã€‚ä¾‹ï¼š/chart 1ï¼Œè·å–è´¦å·1äº¬è±†å˜åŒ–ã€‚
    /cmd æ‰§è¡Œå‘½ä»¤ï¼Œä¾‹ï¼š/cmd python3 /python/bot.pyï¼Œåˆ™æ‰§è¡Œpythonç›®å½•ä¸‹çš„bot.pyã€‚ä¸å»ºè®®ä½¿ç”¨BOTä½¿ç”¨å¹¶å‘ï¼Œå¯èƒ½äº§ç”Ÿä¸æ˜åŸå› çš„å´©æºƒã€‚ 
    /dl ä¸‹è½½æ–‡ä»¶ã€‚
    /edit ä»/jdç›®å½•é€‰æ‹©æ–‡ä»¶å¹¶ç¼–è¾‘ï¼Œéœ€è¦å°†ç¼–è¾‘å¥½ä¿¡æ¯å…¨éƒ¨å‘ç»™BOTï¼ŒBOTä¼šæ ¹æ®ä½ å‘çš„ä¿¡æ¯è¿›è¡Œæ›¿æ¢ã€‚å»ºè®®ä»…ç¼–è¾‘configæˆ–crontab.listï¼Œå…¶ä»–æ–‡ä»¶æ…ç”¨ï¼ï¼ï¼
    /getcookie æ‰«ç è·å–cookieï¼Œ30så†…å¯å–æ¶ˆï¼Œ31s~2åˆ†é’Ÿå†…ä¸èƒ½è¿›è¡Œå…¶ä»–äº¤äº’ç›´åˆ°è¶…æ—¶æˆ–è·å–åˆ°cookieã€‚
    /getfile è·å–/jdç›®å½•ä¸‹æ–‡ä»¶ã€‚
    /log æŸ¥çœ‹è„šæœ¬æ‰§è¡Œæ—¥å¿—ã€‚
    /node æ‰§è¡Œjsè„šæœ¬ï¼Œè¾“å…¥/node jd_bean_changeã€‚å¦‚æ‰§è¡Œéscriptsç›®å½•jsï¼Œéœ€è¾“å…¥ç»å¯¹è·¯å¾„æ‰§è¡Œã€‚nodeå‘½ä»¤ä¼šç­‰å¾…è„šæœ¬æ‰§è¡Œå®Œï¼ŒæœŸé—´ä¸èƒ½ä½¿ç”¨BOTï¼Œå»ºè®®ä½¿ç”¨snodeå‘½ä»¤ã€‚
    /set è®¾ç½®ã€‚
    /setshort è®¾ç½®è‡ªå®šä¹‰æŒ‰é’®ï¼Œæ¯æ¬¡è®¾ç½®ä¼šè¦†ç›–åŸè®¾ç½®ã€‚
    /setname è®¾ç½®å‘½ä»¤åˆ«åã€‚
    /snode é€‰æ‹©è„šæœ¬æ‰§è¡Œï¼Œåªèƒ½é€‰æ‹©/scriptså’Œ/ownç›®å½•ä¸‹çš„è„šæœ¬ï¼Œé€‰æ‹©å®Œåç›´æ¥åå°è¿è¡Œï¼Œä¸å½±å“BOTå“åº”å…¶ä»–å‘½ä»¤ã€‚ 
    /repo ç®¡ç†æ·»åŠ çš„ä»“åº“ã€‚
    /export ç®¡ç†æ·»åŠ çš„ç¯å¢ƒå˜é‡ã€‚
    /install æ‹“å±•æœ¬ç¨‹åºåŠŸèƒ½ã€‚
    /uninstall åˆ é™¤æœ¬ç¨‹åºæ‹“å±•åŠŸèƒ½ã€‚
    /list åˆ—å‡ºæœ¬ç¨‹åºæ‹“å±•çš„åŠŸèƒ½ã€‚
    /addenv é’é¾™æ–°å¢ç¯å¢ƒå˜é‡ã€‚
    /env é’é¾™ç®¡ç†ç¯å¢ƒå˜é‡ã€‚

    æ­¤å¤–ï¼Œç›´æ¥å‘é€æ–‡ä»¶è‡³BOTï¼Œä¼šè®©æ‚¨é€‰æ‹©ä¿å­˜åˆ°ç›®æ ‡æ–‡ä»¶å¤¹ï¼Œæ”¯æŒä¿å­˜å¹¶è¿è¡Œã€‚å‘é€ä»¥ .git ç»“å°¾çš„é“¾æ¥å¼€å§‹æ·»åŠ ä»“åº“ã€‚å‘é€ä»¥ .js .sh .pyç»“å°¾çš„å·²rawé“¾æ¥å¼€å§‹ä¸‹è½½æ–‡ä»¶ã€‚å‘é€æ ¼å¼ä¸º key="value" æˆ–è€… key='value' çš„æ¶ˆæ¯å¼€å§‹æ·»åŠ ç¯å¢ƒå˜é‡ã€‚'''
        await jdbot.edit_message(bot_id, msg_id + 1, msg)
    except Exception as e:
        title = "ã€ğŸ’¥é”™è¯¯ğŸ’¥ã€‘"
        name = "æ–‡ä»¶åï¼š" + os.path.split(__file__)[-1].split(".")[0]
        function = "å‡½æ•°åï¼š" + sys._getframe().f_code.co_name
        tip = 'å»ºè®®ç™¾åº¦/è°·æ­Œè¿›è¡ŒæŸ¥è¯¢'
        await jdbot.send_message(chat_id, f"{title}\n\n{name}\n{function}\né”™è¯¯åŸå› ï¼š{str(e)}\n\n{tip}")
        logger.error(f"é”™è¯¯--->{str(e)}")

